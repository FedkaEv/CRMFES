<html>
    <body>
        <div class="row"  >

            <div class="col-12 col-md-4 col-xl-3   " >
                <h3>АРМ кухня</h3>
                
                <div id="newordersalert" style="display:none;"  class="alert alert-success  ml-4"  >
                    <span id="neworderscnt"></span>
                </div>   
            </div>
            <div class="col-12 col-md-4 col-xl-3   " >
             <i style="cursor:pointer"  onclick="onBell(this)" title="Звуковое уведомление" class="fa fa-bell-slash text-secondary"></i>  
            </div>
            
            <div class="w-100">
                <div class="col-12 col-md-10 col-lg-8" >


                    <a zippy="btnupdate" class="btn btn-info">Обновить</a>
                    <table class="table table-striped">

                        <tr zippy="itemlist">


                            <td zippy="docnumber"> </td>
                            <td zippy="name">  </td>
                            <td zippy="qty" class="text-right">  </td>

                            <td zippy="notes">  </td>


                            <td zippy="docnotes"></td>
                            <td  ><a zippy="ready" class="btn btn-success">Готово</a></td>
                        </tr>

                    </table> 
                    <a id="dankor"></a>
                </div>

            </div> 


            <script>
            
                function onBell(el){
                    $(el).attr('class','fa fa-bell  text-success')
                }
               
            
                window.setInterval(onNewOrder, 5000);

            
                function onNewOrder() {
                        
                        callPageMethod('getMessages',null,null,(data)=> 
                        {
                           
                                var  answer = JSON.parse(data)  
                                
                                if (answer.update==true ) {
                                  
                                      $('#btnupdate').trigger('click') ;
                                      return;
                                }
                             
                                
                                if(answer.cnt > 0){
                                   $('#newordersalert').show();
                                   $('#neworderscnt').text('Новых заказов ' + answer.cnt);
                                   beep()
                                  window.setTimeout(function(){
                                                  
                                        $('#btnupdate').trigger('click') ;
                                        }, 5000); 
                                           
                                 }
                                 
                                
                            });
                }


                                   
            </script>

    </body>
</html>
